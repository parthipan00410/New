name: New Pipeline

on:
  workflow_dispatch:

jobs:
  register-dataset:
    name: Register Dataset
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: pip install -r new/requirements.txt
        
      - name: Run dataset registration
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: python new/model_building/data_prep.py

  data-preparation:
    name: Data Preparation
    runs-on: ubuntu-latest
    needs: register-dataset
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: pip install -r new/requirements.txt
        
      - name: Run data preparation
        run: python new/model_building/data_split.py

  model-training:
    name: Model Training
    runs-on: ubuntu-latest
    needs: data-preparation
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: pip install -r new/requirements.txt
        
      - name: Run model training
        run: python new/model_building/train.py

  deploy-hosting:
    name: Deploy Hosting
    runs-on: ubuntu-latest
    needs: [register-dataset, data-preparation, model-training]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: pip install -r new/requirements.txt
        
      - name: Deploy to Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: python new/hosting/hosting.py
